/*! wangEditor-mobile.js 2016-01-04 */
!function(a){a.___E_mod=function(b){var c=a.___E;null!=c&&b(c,a.Zepto)}}(window),function(a){var b=a.Zepto,c=a.___E,d="github.com/wangfupeng1988/wangEditor-mobile";if(null!=c){if(c.gitlink===d)return void alert("不得重复引用wangEditor的js文件");if(!c.gitlink||c.gitlink!==d)return void alert("window.___E 属性名已经被其他程序占用。wangEditor-mobile引用失败")}return null==b?void alert("wangEditor-mobile依赖于zepto，请先引用zepto.js"):document.createRange&&"function"==typeof document.createRange?void 0:void alert("当前浏览器不支持document.createRange，不能生成富文本编辑器")}(window),function(a,b){var c="github.com/wangfupeng1988/wangEditor-mobile",d=function(a){var c=this;c.$body=b("body");var d=b("#"+a);c.$textarea=d,c.checkTapTime=function(a,d){var e,f,g=a.type.toLowerCase(),h=!0;return g.indexOf("tap")<0?h:(a?(e=a.currentTarget||a.target,f=b(e)):f=c.$body,null==f.data("tapTime")?(f.data("tapTime",Date.now().toString()),h=!0):Date.now()-parseInt(f.data("tapTime"))<100?(a.preventDefault(),a.stopPropagation(),h=!1):(f.data("tapTime",Date.now().toString()),h=!0),h)},c.initDefaultConfig(),c.addTxt(),c.addMenus()};d.fn=d.prototype,d.fn.gitlink=c,d.log=function(b,c){a.console?c?console.log(b,c):console.log(b):(alert(b),c&&alert(c))},d.warn=function(b,c){a.console?c?console.warn(b,c):console.warn(b):(alert(b),c&&alert(c))},a.___E=d}(window,window.Zepto),window.___E_mod(function(a,b){}),window.___E_mod(function(a,b){var c=window.navigator.userAgent.toLowerCase();a.isAndroid=c.indexOf("android")>0,a.isUC=c.indexOf("ucbrowser")>0,a.agent=c}),window.___E_mod(function(a,b){a.config={menuColorValue:"red",menuQuoteStyle:{display:"block","border-left":"5px solid #d0e5f2",padding:"4px 0 4px 10px","background-color":"#f1f1f1",margin:"4px 0"},menus:["head","bold","color","quote","list","img","happy","check"],happy:["http://wangeditor.github.io/expressions/1.gif","http://wangeditor.github.io/expressions/2.gif","http://wangeditor.github.io/expressions/3.gif","http://wangeditor.github.io/expressions/4.gif","http://wangeditor.github.io/expressions/5.gif","http://wangeditor.github.io/expressions/6.gif","http://wangeditor.github.io/expressions/7.gif","http://wangeditor.github.io/expressions/8.gif","http://wangeditor.github.io/expressions/9.gif","http://wangeditor.github.io/expressions/10.gif","http://wangeditor.github.io/expressions/11.gif","http://wangeditor.github.io/expressions/12.gif","http://wangeditor.github.io/expressions/13.gif","http://wangeditor.github.io/expressions/14.gif","http://wangeditor.github.io/expressions/15.gif","http://wangeditor.github.io/expressions/16.gif","http://wangeditor.github.io/expressions/17.gif","http://wangeditor.github.io/expressions/18.gif","http://wangeditor.github.io/expressions/19.gif","http://wangeditor.github.io/expressions/20.gif"],uploadImgUrl:"",uploadTimeout:1e4,testHostname:"localhost",loadingImg:"http://images2015.cnblogs.com/blog/138012/201512/138012-20151208194759027-506651939.gif"}}),window.___E_mod(function(a,b){a.fn.initDefaultConfig=function(){var c=this,d=a.config,e=b.extend({},d);c.config=e}}),window.___E_mod(function(a,b){a.isAndroid,a.isUC}),window.___E_mod(function(a,b){a.fn.addTxt=function(){var a=this,c=a.$textarea,d=b.trim(c.val()),e=b('<div contentEditable="true" class="wangEditor-mobile-txt">'+d+"</div>"),f=b('<div class="wangEditor-mobile-modal-container"></div>');a.$txt=e,a.$modalContainer=f,a.insertEmpltyLink()}}),window.___E_mod(function(a,b){a.fn.addMenus=function(){var a=this,c=b('<div class="wangEditor-mobile-menu-container" contentEditable="false"></div>'),d=b('<div class="item-container"></div>'),e=b('<div class="tip"></div>');c.append(e),c.append(d),a.$menuContainer=c,a.$menuItemContainer=d,a.menus={},a.addMenuBold("bold"),a.addMenuHead("head"),a.addMenuColor("color"),a.addMenuQuote("quote"),a.addMenuList("list"),a.addMenuCheck("check"),a.addMenuHappy("happy"),a.addMenuImg("img")}}),window.___E_mod(function(a,b){a.fn.addMenuBold=function(a){var c=this,d=c.menus;d[a]={selected:!1,$trigger:b('<div><i class="icon-wangEditor-m-bold"></i></div>'),$wrap:b('<div class="item"></div>'),bindEvent:function(a){var b=this;b.$trigger.on("singleTap",function(a){c.checkTapTime(a,"bold")!==!1&&c.command("bold",!1,void 0,a)})},updateStyle:function(a){var b=this,c=b.$trigger;document.queryCommandState("bold")?(b.selected=!0,c.addClass("selected")):(b.selected=!1,c.removeClass("selected"))}}}}),window.___E_mod(function(a,b){a.fn.addMenuHead=function(a){var c=this,d=c.menus;d[a]={selected:!1,$trigger:b('<div><i class="icon-wangEditor-m-header"></i></div>'),$wrap:b('<div class="item"></div>'),bindEvent:function(a){var b=this;b.$trigger.on("singleTap",function(a){c.checkTapTime(a,"head")!==!1&&(b.selected?c.command("formatblock",!1,"p",a):c.command("formatblock",!1,"h3",a))})},updateStyle:function(a){var b=this,c=b.$trigger,d=document.queryCommandValue("formatblock");/^h\d{1}$/i.test(d)?(b.selected=!0,c.addClass("selected")):(b.selected=!1,c.removeClass("selected"))}}}}),window.___E_mod(function(a,b){a.fn.addMenuColor=function(a){var c=this,d=c.menus,e=c.config.menuColorValue;d[a]={selected:!1,$trigger:b('<div><i class="icon-wangEditor-m-brush"></i></div>'),$wrap:b('<div class="item"></div>'),bindEvent:function(a){var b=this,d=b.$trigger;d.on("singleTap",function(a){if(c.checkTapTime(a,"color")!==!1){var d=e;b.selected&&(d="#000"),c.command("forecolor",!1,d,a)}})},updateStyle:function(a){var b=this,c=b.$trigger,d=document.queryCommandValue("forecolor");"rgb(0, 0, 0)"!==d?(b.selected=!0,c.addClass("selected")):(b.selected=!1,c.removeClass("selected"))}}}}),window.___E_mod(function(a,b){a.fn.addMenuQuote=function(a){var c=this,d=c.menus,e=(c.$txt,c.config.menuQuoteStyle);d[a]={selected:!1,$trigger:b('<div><i class="icon-wangEditor-m-quote-left"></i></div>'),$wrap:b('<div class="item"></div>'),bindEvent:function(a){var d=this;d.$trigger.on("singleTap",function(a){if(c.checkTapTime(a,"quote")!==!1){var f,g,h,i=c.$focusElem;if(d.selected){if(f="BLOCKQUOTE"===i.get(0).nodeName?i:i.closest("blockquote"),0===f.length)return;g=f.text(),h=function(){var a=b("<p>"+g+"</p>");f.after(a),f.remove()},c.customCommand(!1,h,a)}else c.command("formatblock",!1,"blockquote",a),c.$txt.find("blockquote").each(function(a,c){var d=b(c),f="w_editor_quote_style",g=d.attr(f);null==g&&(d.css(e),d.attr(f,"1"))})}})},updateStyle:function(a){var b=this,c=b.$trigger,d=document.queryCommandValue("formatblock");/^blockquote$/i.test(d)?(b.selected=!0,c.addClass("selected")):(b.selected=!1,c.removeClass("selected"))}}}}),window.___E_mod(function(a,b){a.fn.addMenuList=function(a){var c=this,d=c.menus;d[a]={selected:!1,$trigger:b('<div><i class="icon-wangEditor-m-list-ul"></i></div>'),$wrap:b('<div class="item"></div>'),bindEvent:function(a){var b=this;b.$trigger.on("singleTap",function(a){c.checkTapTime(a,"list")!==!1&&(b.selected||c.$focusElem.removeClass("focus-elem"),c.command("InsertUnorderedList",!1,void 0,a))})},updateStyle:function(a){var b=this,c=b.$trigger;document.queryCommandState("InsertUnorderedList")?(b.selected=!0,c.addClass("selected")):(b.selected=!1,c.removeClass("selected"))}}}}),window.___E_mod(function(a,b){a.fn.addMenuCheck=function(a){var c=this,d=c.menus;d[a]={selected:!1,$trigger:b('<div><i class="icon-wangEditor-m-checkbox-checked"></i></div>'),$wrap:b('<div class="item"></div>'),bindEvent:function(a){var d=Date.now(),e=this;e.$trigger.on("singleTap",function(a){if(c.checkTapTime(a,"check")!==!1){var e=b('<input type="checkbox"/>'),f=b("<p></p>");f.append(e).append("&nbsp;&nbsp;"),e.on("singleTap",function(a){if(!(Date.now()-d<50)){d=Date.now();var c=b(a.target),e=c.is(":checked");c.prop("checked",!e),a.preventDefault(),a.stopPropagation()}});var g=function(){c.$focusElem.after(f)};c.customCommand(!1,g,a)}})},updateStyle:function(a){}}}}),window.___E_mod(function(a,b){a.fn.addMenuHappy=function(c){var d=this,e=d.$body,f=d.menus,g=d.config.happy,h=d.$txt;g.length>0&&0===g[0].indexOf("http://wangeditor.github.io/expressions")&&a.warn("正在使用wangEdior提供的免费表情图标，它们将从 github 下载，速度很慢！！！建议将表情图标重新配置，请参见文档说明"),f[c]={selected:!1,$trigger:b('<div><i class="icon-wangEditor-m-happy"></i></div>'),$wrap:b('<div class="item"</div>'),$modal:b('<div class="wangEditor-mobile-modal"></div>'),renderModal:function(){var a=this,c=a.$modal,f='<span class="command-link" commandValue="#{imgUrl}"><img src="#{imgUrl}"/></span>',h=[];b.each(g,function(a,b){h.push(f.replace(/#{imgUrl}/gi,b))}),c.append(h.join("")),e.append(c);var i=c.width();c.css("margin-left",(0-i)/2),c.on("click",".command-link",function(a){a.preventDefault()}),c.on("singleTap",".command-link",function(c){if(d.checkTapTime(c,"happy command-link")!==!1){var e=b(c.currentTarget),f=e.attr("commandValue");d.command("InsertImage",!1,f,c),a.hideModal()}})},showModal:function(){var a=this,b=a.$modal,c=e.get(0).scrollTop;b.show(),b.css({"margin-top":c+50+"px"});var d=function(b){a.hideModal(),h.off("singleTap",d)};h.on("singleTap",d)},hideModal:function(){this.$modal.hide()},bindEvent:function(a){function b(){e.renderModal(),e.showModal()}function c(){e.showModal()}var e=this,f=e.$trigger;e.$modal;f.one("singleTap",function(a){d.checkTapTime(a,"happy one")!==!1&&d.customCommand(!0,b,a)}),f.on("singleTap",function(a){d.checkTapTime(a,"happy on")!==!1&&d.customCommand(!0,c,a)})},updateStyle:function(){}}}}),window.___E_mod(function(a,b){a.fn.addMenuImg=function(c){function d(b){j&&a.log(b)}var e=this,f=e.$body,g=(e.$txt,e.menus),h=a.isAndroid,i=a.isUC,j=!1,k="inputfile"+Math.random().toString().slice(2);g[c]={selected:!1,$trigger:function(){return b(h||i?'<div><i class="icon-wangEditor-m-picture"></i></div>':'<label for="'+k+'"><i class="icon-wangEditor-m-picture"></i></label>')}(),$wrap:b('<div class="item"</div>'),renderForm:function(){var a=["<form",'    enctype="multipart/form-data"','    method="post">','    <input id="'+k+'" type="file" accept="image/*">',"</form>"].join(""),c=b('<div style="display:none;"></div>');c.html(a),f.append(c)},bindEvent:function(a){function c(a,b){for(var c=window.atob(a.split(",")[1]),d=new ArrayBuffer(c.length),e=new Uint8Array(d),f=0;f<c.length;f++)e[f]=c.charCodeAt(f);return""!==b&&b||(b="image/png"),new Blob([d],{type:b})}var f=this,g=f.$trigger;f.renderForm();var h=b("#"+k);h.on("change",function(a){var f=e.config,g=f.uploadImgUrl||"",i=f.testHostname||"localhost",k=f.loadingImg,l=f.uploadTimeout||1e4;if(j=i===window.location.hostname,!window.FileReader||!window.FormData)return void alert("当前浏览器不支持html5中的 FileReader 和 FormData，无法上传图片");if(""===g)return void alert("没有配置 uploadImgUrl ，wangEditor 将无法上传图片。\n\n想要配置上传图片，请参见文档说明。\n\n不想要图片上传，可通过配置 menus 隐藏该功能。");var m=h[0].files||[];if(0!==m.length){var n=m[0],o=n.type||"",p=new FileReader,q=e.$focusElem;d("选中的文件为："+n.name),d("服务器端上传地址为："+g),p.onload=function(a){function f(){d("访问超时（配置的超时事件是："+l+"）");var a=b("#"+r);a.remove(),i.abort&&i.abort(),alert("上传超时，请重试"),"wangeditor.github.io"===location.hostname.toLowerCase()&&alert("提示：wangEditor官网demo没有后台服务，因此超时（该alert在实际项目中不会出现）")}var h,i,j,m,p=a.target.result||this.result,r="div"+Math.random().toString().slice(2),s="info"+Math.random().toString().slice(2);window.URL&&window.URL.createObjectURL?(h=window.URL.createObjectURL(n),q.after('<div class="previmg-container" id="'+r+'">   <p class="info" id="'+s+'">上传中...</p>	<img src="'+h+'" style="opacity:0.2; max-width:100%;"/></div>')):(h=k,q.after('<div class="previmg-container" id="'+r+'">	<img src="'+h+'" style="max-width:100%;"/></div>')),d("生成预览图片，src是："+h),i=new XMLHttpRequest,j=new FormData,d("准备上传文件..."),i.open("POST",g,!0),m=setTimeout(f,l),i.onload=function(){clearTimeout(m);var a,c,f,g=i.responseText,h=b("#"+r);d("服务器端的返回数据为："+g),0===g.indexOf("error|")?(a=g.split("|")[1],d("很遗憾，后台返回error，错误信息为："+a),alert("上传图片错误: \n"+a),h.remove()):(d("请确认以上图片是否有效，无效将无法显示在页面中"),d("准备下载该图片..."),b("#"+s).text("加载中..."),c=document.createElement("img"),c.src=g,c.onload=function(){d("下载完成，正式呈现在编辑区域"),f=b(c),f.css("max-width","100%"),h.after(f),h.remove(),e.saveSourceCode()},c.onerror=function(){d("图片加载失败，请确定这个url是否能成功得到图片："+g),alert("图片加载失败"),h.remove(),e.saveSourceCode()})},j.append("wangEditorMobileFile",c(p,o)),i.send(j)},p.readAsDataURL(n)}}),g.on("singleTap",function(a){function b(){h.trigger("click")}e.checkTapTime(a,"img")!==!1&&e.customCommand(!0,b,a)})},updateStyle:function(){}}}}),window.___E_mod(function(a,b){a.fn.renderTxt=function(){var a=this,b=a.$textarea,c=a.$txt,d=a.$modalContainer,e=a.$body;b.after(c),b.hide(),e.append(d)}}),window.___E_mod(function(a,b){a.fn.renderMenu=function(){var a=this,c=a.menus,d=a.$menuContainer,e=a.$menuItemContainer,f=(a.$txt,b('<div class="gap"></div>')),g=a.$body,h=a.config.menus;b.each(h,function(a,b){var d=c[b];if(null!=d){var g=d.$trigger,h=d.$wrap;g&&(h?(h.append(g),e.append(h)):e.append(g),e.append(f.clone()))}}),e.children().last().remove(),d.hide(),a.menuDisplayShow=!1,g.append(d)}}),window.___E_mod(function(a,b){a.fn.bindDocumentEvent=function(){var a=b(document),c=this,d=(c.$txt,Date.now());a.on("scroll",function(a){Date.now()-d<=50||(d=Date.now(),c.hideMenuContainer())})}}),window.___E_mod(function(a,b){a.fn.bindTxtEvent=function(){function a(){var a,d;c.saveSelection(),a=c.getWrapRangeElem(),a&&(d=b(a),d.addClass("focus-elem"),c.$focusElem=d),c.updateMenuStyle()}var c=this,d=c.$txt,e=c.$menuContainer,f=e.get(0),g=Date.now();d.on("focus",function(){c.isFocus=!0}),d.on("singleTap",function(e){if(c.checkTapTime(e,"$txt")!==!1&&c.isFocus){var f=b(e.target);if(c.eventTarget(f),f.hasClass("focus-elem"))return void c.hideMenuContainer();if("IMG"===f.get(0).nodeName)return void c.hideMenuContainer();if(f.get(0)===d.get(0))return void c.hideMenuContainer();c.setMenuContainerPosition();var g=c.$focusElem;g&&g.removeClass("focus-elem"),setTimeout(a,c.txtTapDelay),c.txtTapDelay=100,e.stopPropagation()}}),d.on("scroll",function(a){Date.now()-g<=50||(g=Date.now(),c.hideMenuContainer(),a.stopPropagation())}),d.on("keydown",function(a){c.hideMenuContainer();var b=d.html();8===a.keyCode&&/^<(\w+)[^<>]*><br><\/\1>$/.test(b)&&a.preventDefault()}),d.on("longTap, doubleTap",function(){c.hideMenuContainer()}),d.on("blur",function(a){c.isFocus=!1;var b=a.explicitOriginalTarget;return f.contains(b)?void a.preventDefault():(c.saveSourceCode(),void c.hideMenuContainer())})}}),window.___E_mod(function(a,b){a.fn.bindMenuContainerEvent=function(){var a=this,b=a.$menuContainer;b.on("tap",function(a){a.preventDefault(),a.stopPropagation()})}}),window.___E_mod(function(a,b){a.fn.bindMenuBtnEvent=function(){var a=this,c=a.menus;b.each(c,function(b,c){var d=c.bindEvent;d&&"function"==typeof d&&d.call(c,a)})}}),window.___E_mod(function(a,b){a.fn.eventTarget=function(a){var b=this;return null==a?b.$eventTargetElem:void(b.$eventTargetElem=a)},a.fn.saveSourceCode=function(){var a=this,b=a.$txt,c=a.$textarea,d="",e=b.clone(),f=e.find(".focus-elem");f.removeClass("focus-elem"),d=e.html(),d=d.replace(/\s?class=""/g,""),c.val(d)},a.fn.insertEmpltyLink=function(){var a=this,c=a.$txt,d=c.children();return 0===d.length?void c.append(b("<p><br></p>")):void("<br>"!==d.last().html()&&c.append(b("<p><br></p>")))}}),window.___E_mod(function(a,b){a.fn.setMenuContainerPosition=function(){var a=this,b=a.eventTarget(),c=b.offset().top,d=a.$txt,e=d.offset().top,f=d.offset().left,g=a.$menuContainer,h=(g.height(),c);e>h&&(h=e),h-=55,g.css({top:h,left:f+2}),a.showMenuContainer()},a.fn.showMenuContainer=function(){var a=this,b=a.$menuContainer;a.menuDisplayShow===!1&&(b.show(),b.css("opacity","0.9"),a.menuDisplayShow=!0)},a.fn.hideMenuContainer=function(){var a=this,b=a.$menuContainer,c=a.$txt,d=a.$focusElem,e=c.find(".focus-elem");a.menuDisplayShow&&(b.hide(),b.css("opacity","0"),a.menuDisplayShow=!1,d&&(d.removeClass("focus-elem"),e.removeClass("focus-elem")))}}),window.___E_mod(function(a,b){a.fn.updateMenuStyle=function(){var a=this,c=a.menus;b.each(c,function(a,b){var c=b.updateStyle;c&&c.call(b)})}}),window.___E_mod(function(a,b){var c=/insertimage/i;a.fn.command=function(a,b,d,e,f){var g=this,h=c.test(a),i=function(){document.execCommand(a,!!b,d)};g.customCommand(h,i,e,f)},a.fn.customCommand=function(a,b,c,d){var e=this,f=e.currentRange(),g=e.currentWrapRange();e.$txt;a?e.restoreSelection(f):e.restoreSelection(g),b(),e.insertEmpltyLink(),e.saveSelection(),e.restoreSelection(f),c&&(c.preventDefault(),c.stopPropagation()),d&&d.call(e),e.hideMenuContainer()}}),window.___E_mod(function(a,b){a.fn.currentRange=function(a){return a?void(this.currentRangeData=a):this.currentRangeData},a.fn.currentWrapRange=function(a){return a?void(this.currentWrapRangeData=a):this.currentWrapRangeData},a.fn.getWrapRangeElem=function(){var a,b,c=this,d=c.$txt,e=d.attr("class"),f=this.currentWrapRange();c.eventTarget().get(0);return null!=f?(a=f.commonAncestorContainer,b=3===a.nodeType?a.parentNode:a,b.className===e&&(b=d.children().last().get(0)||b),b):void 0},a.fn.saveSelection=function(a){var b,c,d,e=this,f=e.$txt.get(0);a?b=a.commonAncestorContainer:(c=document.getSelection(),c.getRangeAt&&c.rangeCount&&(a=document.getSelection().getRangeAt(0),b=a.commonAncestorContainer)),b&&(f.contains(b)||f===b)&&(e.currentRange(a),d=document.getSelection().getRangeAt(0),d.selectNodeContents(b),e.currentWrapRange(d))},a.fn.restoreSelection=function(a){var b;a&&(b=document.getSelection(),b.removeAllRanges(),b.addRange(a))}}),window.___E_mod(function(a,b){}),window.___E_mod(function(a,b){a.fn.init=function(){var a=this;a.renderTxt(),a.renderMenu(),a.bindDocumentEvent(),a.bindTxtEvent(),a.bindMenuBtnEvent(),a.bindMenuContainerEvent()}});